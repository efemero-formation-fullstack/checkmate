test_name: Test of the /player/:id endpoint

stages:
  - name: Get a player JWT
    request:
      url: http://localhost:8080/auth/login
      data:
        login: test_player
        password: test_password
      method: POST
    response:
      status_code: 200
      save:
        json:
          test_player_token: access_token

  - name: Get an admin JWT
    request:
      url: http://localhost:8080/auth/login
      data:
        login: MrCheckmate
        password: SUPER_SECRET_PASSWORD
      method: POST
    response:
      status_code: 200
      save:
        json:
          test_admin_token: access_token

  - name: Cannot get user if not connected
    request:
      url: http://localhost:8080/player/200
      method: GET
    response:
      status_code: 401

  - name: Cannot get user if not admin or self
    request:
      url: http://localhost:8080/player/200
      method: GET
      headers:
        Authorization: "bearer {test_player_token:s}"
    response:
      status_code: 403

  - name: Get user as self
    request:
      url: http://localhost:8080/player/1002
      method: GET
      headers:
        Authorization: "bearer {test_player_token:s}"
    response:
      status_code: 200

  - name: Get user as admin
    request:
      url: http://localhost:8080/player/1002
      method: GET
      headers:
        Authorization: "bearer {test_admin_token:s}"
    response:
      status_code: 200

  - name: Get user as admin and self
    request:
      url: http://localhost:8080/player/1
      method: GET
      headers:
        Authorization: "bearer {test_admin_token:s}"
    response:
      status_code: 200

  - name: Get inexistant user as admin must return 404
    request:
      url: http://localhost:8080/player/99999
      method: GET
      headers:
        Authorization: "bearer {test_admin_token:s}"
    response:
      status_code: 404
